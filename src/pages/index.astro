---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import '../assets/home.css';
---
<Layout page="home">
	<!-- Hero section with p5 canvas -->
	<section class="hero-section">
		<!-- Video intro overlay (inside hero section) -->
		<div id="video-intro" class="video-intro-overlay">
			<video id="intro-video" autoplay muted playsinline preload="auto" crossorigin="anonymous">
				<source src="/programa.webm" type="video/webm">
				<source src="/programa.mp4" type="video/mp4">
				Tuo browser non supporta il formato video.
			</video>
		</div>
		
		<div id="p5-root" aria-hidden="true"></div>
		
		<!-- Hero title -->
		<h1 class="hero-title">Program.A</h1>
	</section>

	<Header includeStyles={false} />

	<!-- Content section with geometric backgrounds -->
	<section class="content-section">
		<div class="content-wrapper">
			<!-- Block 1 -->
			<article class="content-block block-1">
				<div class="text-content">
					<h4>Gruppo N a Bruno Munari, 12 gennaio 1962</h4>
					<p>"Riteniamo il titolo Arte Programmata il più appropriato <br> a definire i 
					nostri esperimenti, per la maggior parte <br> dei nostri lavori sarà da precisare che 
					il programmatore dell'opera è lo stesso spettatore che sceglie una visione piuttosto 
					che un'altra oppure ne determina delle variazioni indeterminabili cogliendo l'oggetto 
					nel movimento della sua visuale."</p>
				</div>
			</article>
	
		<div id="valori"> <h2> I valori dell'arte programmata </h2> </div>		
			
		<div class="row-group">
			<div class="content-geo-pair">
				<article class="content-block block-2">
					<div class="floating-squares"></div>
					<div class="text-content">
						<h3> SPETTATORE CO-CREATORE</h3>
						<p>L'arte programmata mira a offrire al pubblico una piattaforma materiale che possa 
							includerlo come co-creatore dell'opera. 
							<br> Automatizzando la realizzazione dell'opera, 
							<br> si richiede un'attività concreta da parte dello spettatore, coinvolto sul piano 
							psicologico <br> e percettivo.</p>
					</div>
				</article>
			</div>

			<div class="content-geo-pair">
				<section class="geometric-section geo-1">
					<div class="geo-container"></div>
				</section>
			</div>
		</div>

		<div class="row-group">
			<div class="content-geo-pair">
				<section class="geometric-section geo-2">
					<div class="geo-container"></div>
				</section>
			</div>

			<div class="content-geo-pair">
				<article class="content-block block-3">
					<div class="floating-squares"></div>
					<div class="text-content">
						<h3>STRUTTURA APERTA</h3>
						<p>Le forme sono finite, logiche e definite, ma <br> la loro manifestazione nello spazio e 
							nel tempo, come oggetti concreti in movimento, le rende infinite, imprevedibili e 
							prossime alla pura casualità.</p>
					</div>
				</article>
			</div>
		</div>

		<div class="row-group">
			<div class="content-geo-pair">
				<article class="content-block block-4">
					<div class="floating-squares"></div>
					<div class="text-content">
<h3>CINETISMO&nbsp;E MUTAZIONE</h3>
						<p>I meccanismi creano il movimento, scoprendo la realtà sempre cangiante del mondo 
							fenomenico. L'analisi dei fenomeni percettivi diviene la chiave per la scoperta 
							di nuovi valori</p>
					</div>
				</article>
			</div>

			<div class="content-geo-pair">
				<article class="content-block block-5">
					<div class="floating-squares"></div>
					<div class="text-content">
						<h3>EFFETTO PROGRAMMATO </h3>
						<p>Ad essere "programmata" in senso tecnico o elettronico è tanto l'opera d'arte 
							quanto l'effetto che essa avrà sullo spettatore. L'artista è un tecnico che 
							interpreta la realtà e i fenomeni visivi in senso scientifico e metodico. L'opera, 
							realizzata sulla base di calcoli, ripetizioni, variazioni  di sequenze di forme, 
							colori e pattern visivi, è concepita alla stregua di una funzione algoritmica.</p>
					</div>
				</article>
			</div>
		</div>
	</div>
	</section>

		<section class="mostra-section">
			<div class="mostra-wrapper">
				<div class="mostra-header">
					<h2>Museo del novecento, mostra arte programmata</h2>
				</div>

				<div class="mostra-carousel" aria-label="Carosello fotografico mostra">
					<div class="mostra-track" role="list">
						<!-- Original 6 slides -->
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9374.jpg" alt="Mostra Arte Programmata - sala con opere e visitatori" loading="lazy" />
						</div>
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9379.jpg" alt="Mostra Arte Programmata - opere luminose" loading="lazy" />
						</div>
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9380.jpg" alt="Mostra Arte Programmata - installazione e pubblico" loading="lazy" />
						</div>
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9381.jpg" alt="Mostra Arte Programmata - dettaglio di opera ottica" loading="lazy" />
						</div>
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9385.jpg" alt="Mostra Arte Programmata - visitatori nella sala" loading="lazy" />
						</div>
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9392.jpg" alt="Mostra Arte Programmata - prospettiva sulle installazioni" loading="lazy" />
						</div>
						<!-- Duplicate all 6 slides for seamless infinite loop -->
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9374.jpg" alt="Mostra Arte Programmata - sala con opere e visitatori" loading="lazy" />
						</div>
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9379.jpg" alt="Mostra Arte Programmata - opere luminose" loading="lazy" />
						</div>
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9380.jpg" alt="Mostra Arte Programmata - installazione e pubblico" loading="lazy" />
						</div>
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9381.jpg" alt="Mostra Arte Programmata - dettaglio di opera ottica" loading="lazy" />
						</div>
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9385.jpg" alt="Mostra Arte Programmata - visitatori nella sala" loading="lazy" />
						</div>
						<div class="mostra-slide" role="listitem">
							<img src="/mostra/_MG_9392.jpg" alt="Mostra Arte Programmata - prospettiva sulle installazioni" loading="lazy" />
						</div>
					</div>
				</div>
			</div>
		</section>	<Footer includeStyles={false} />

	<script type="module" src="/js/p5-boot.mjs" is:inline></script>
	<script src="/js/scroll-animations.js" is:inline></script>
	<script src="/js/floatingSquares.js" is:inline></script>
	<script src="/js/geometricShapes.js" is:inline></script>
	
	<script is:inline>
	//<![CDATA[
		// Video intro handler
		const videoIntro = document.getElementById('video-intro');
		const introVideo = document.getElementById('intro-video');
		const heroTitle = document.querySelector('.hero-title');
		
		// Detect Safari browser
		const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome|Firefox|Edge/.test(navigator.userAgent);
		
		if (videoIntro && introVideo) {
			// On Safari, hide video and show title instead
			if (isSafari) {
				introVideo.style.display = 'none';
				if (heroTitle) {
					heroTitle.classList.add('show');
				}
			} else {
				// On other browsers, use video normally
				// When video ends, keep it frozen on last frame
				introVideo.addEventListener('ended', () => {
					introVideo.pause();
					console.log('Video ended and frozen on last frame');
				});

				// Handle video load success
				introVideo.addEventListener('loadeddata', () => {
					console.log('Video loaded successfully');
				});

				// Handle video error - show title as fallback
				introVideo.addEventListener('error', (e) => {
					console.error('Video error:', e, introVideo.error);
					if (heroTitle) {
						heroTitle.classList.add('show');
					}
				});

				// Force play on load
				introVideo.play().catch(err => {
					console.log('Autoplay prevented or video failed:', err);
					if (heroTitle && introVideo.readyState === introVideo.HAVE_NOTHING) {
						heroTitle.classList.add('show');
					}
				});
				
				// Timeout fallback
				setTimeout(() => {
					if (introVideo.readyState === introVideo.HAVE_NOTHING && heroTitle) {
						heroTitle.classList.add('show');
					}
				}, 2000);
			}
		}

		// Mostra carousel - continuous infinite smooth scroll
		const mostraCarousel = document.querySelector('.mostra-carousel');
		if (mostraCarousel) {
			const track = mostraCarousel.querySelector('.mostra-track');
			const slides = Array.from(mostraCarousel.querySelectorAll('.mostra-slide'));
			const originalCount = 6; // Original slides before duplication
			
			let position = 0;
			let isScrolling = true;
			let lastTime = Date.now();

			const slideWidth = slides[0].offsetWidth;
			const gap = parseInt(getComputedStyle(track).gap) || 0;
			const slideStep = slideWidth + gap;
			const totalDistance = originalCount * slideStep;

			const animate = () => {
				const now = Date.now();
				const elapsed = now - lastTime;
				lastTime = now;

				if (isScrolling) {
					// Slower speed: 30px per second instead of 60px
					position -= (120 * elapsed) / 1000;
					
					// Seamless loop: reset without visual jump
					if (position <= -totalDistance) {
						position = 0;
					}
					
					track.style.transform = `translateX(${position}px)`;
				}
				requestAnimationFrame(animate);
			};

			animate();

			// Pause on hover
			mostraCarousel.addEventListener('mouseenter', () => {
				isScrolling = false;
			});

			mostraCarousel.addEventListener('mouseleave', () => {
				isScrolling = true;
			});
		}
	//]]>
	</script>
</Layout>
